Subquery Example:

SELECT first_name, last_name
FROM customer
WHERE customer_id = (
    SELECT customer_id
    FROM payment
    GROUP BY customer_id
    ORDER BY SUM(amount) DESC
    LIMIT 1
);



CTE :

WITH top_customer AS (
    SELECT customer_id, SUM(amount) AS total_amount
    FROM payment
    GROUP BY customer_id
    ORDER BY total_amount DESC
    LIMIT 1
)
SELECT first_name, last_name
FROM customer
WHERE customer_id = (SELECT customer_id FROM top_customer);
